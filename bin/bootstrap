#!/bin/bash

if ! type python3 &> /dev/null; then
  echo "You haven't installed Python 3"
  exit 1
fi

bin_path=/usr/local/bin

${bin_path}/pip3 install --upgrade pip

if ! ${bin_path}/pip3 list | grep ansible &> /dev/null; then
  echo 'Installing ansible...'
  sudo -H ${bin_path}/pip3 install ansible
else
  echo 'Already installed ansible'
fi

if ! ${bin_path}/pip3 list | grep pexpect &> /dev/null; then
  echo 'Installing pexpect...'
  sudo -H ${bin_path}/pip3 install pexpect
else
  echo 'Already installed pexpect'
fi

if [[ ! -d /etc/ansible ]]; then
  echo 'Initializing inventory...'
  sudo mkdir /etc/ansible
  dir="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
  sudo ln -s "$dir/../etc/hosts" /etc/ansible/hosts
else
  echo 'Already initialized inventory'
fi

${bin_path}/ansible-playbook --ask-become-pass --diff site.yml
