#!/bin/bash

if ! type python &> /dev/null; then
  echo "You haven't installed Python"
  exit 1
fi

bin_path=/usr/local/bin

${bin_path}/pip install --upgrade pip

if ! type ${bin_path}/pip &> /dev/null; then
  echo 'Installing pip...'
  sudo easy_install pip
else
  echo 'Already installed pip'
fi

if ! ${bin_path}/pip list | grep ansible &> /dev/null; then
  echo 'Installing ansible...'
  sudo easy_install nose
  sudo easy_install tornado
  sudo -H ${bin_path}/pip install ansible
else
  echo 'Already installed ansible'
fi

if ! ${bin_path}/pip list | grep pexpect &> /dev/null; then
  echo 'Installing pexpect...'
  sudo -H ${bin_path}/pip install pexpect
else
  echo 'Already installed pexpect'
fi

if [[ ! -d /etc/ansible ]]; then
  echo 'Initializing inventory...'
  sudo mkdir /etc/ansible
  dir="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
  sudo ln -s "$dir/../etc/hosts" /etc/ansible/hosts
else
  echo 'Already initialized inventory'
fi

${bin_path}/ansible-playbook --ask-become-pass site.yml
